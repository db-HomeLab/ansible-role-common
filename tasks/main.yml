---
# - name: Import distribution vars
#   ansible.builtin.include_vars: "{{lookup('ansible.builtin.first_found', params)}}"
#   vars:
#     params:
#       files:
#         - '{{ ansible_distribution }}.yml'
#         - '{{ ansible_os_family }}.yml'
#         - default.yml
#       paths:
#         - 'vars'

- name: Install common packages
  become: true
  ansible.builtin.apt:
    name: "{{ packages }}"
    state: latest
    update_cache: true
  #with_items: "{{ packages }}"
  when: "ansible_os_family == 'Debian'"

- name: Add public keys to hosts
  become: true
  ansible.posix.authorized_key:
    user: root
    state: present
    key: "{{ item }}"
  loop: "{{ public_keys }}"

- block:
  - name: Edit sshd_config PermitRootLogin
    become: true
    lineinfile:
      path: /etc/ssh/sshd_config
      regex: ^(# *)?PermitRootLogin
      line: PermitRootLogin prohibit-password

